{
    "terraform": {
        "required_providers": [
            {
                "huaweicloud": {
                    "source": "huawei.com/provider/huaweicloud",
                    "version": "1.50.0"
                }
            }
        ]
    },
    "provider": {
        "huaweicloud": {
            "cloud": "myhuaweicloud.com",
            "endpoints": {
                "iam": "iam.cn-north-4.myhuaweicloud.com",
                "dns": "dns.cn-north-4.myhuaweicloud.com"
            },
            "enterprise_project_id": "${var.enterprise_project_id}",
            "insecure": true,
            "region": "cn-north-4",
            "auth_url": "https://iam.cn-north-4.myhuaweicloud.com/v3"
        }
    },
    "variable": {
        "enterprise_project_id": {
            "default": "0",
            "description": "企业项目id，请参考部署指南到项目管理界面获取https://console.huaweicloud.com/eps/，0代表default项目。默认为0。",
            "type": "string",
            "nullable": false,
            "validation": {
                "condition": "${length(regexall(\"^[a-z0-9]{8}(-[a-z0-9]{4}){3}-[a-z0-9]{12}$|^0$\",var.enterprise_project_id))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "vpc_name": {
            "default": "gameflexmatch-hosting-platform-demo",
            "description": "虚拟私有云 VPC名称，该模板新建VPC，不允许重名。取值范围：1-54个字符，支持数字、字母、中文、_（下划线）、-（中划线）、.（点）。默认为gameflexmatch-hosting-platform-demo",
            "type": "string",
            "nullable": "false"
        },
        "security_group_name": {
            "default": "gameflexmatch-hosting-platform-demo",
            "description": "安全组名称，该模板新建安全组，安全组规则请参考部署指南进行配置。取值范围：1-64个字符，支持数字、字母、中文、_（下划线）、-（中划线）、.（点）。默认为gameflexmatch-hosting-platform-demo",
            "type": "string",
            "nullable": "false"
        },
        "eip_bandwidth_size": {
            "default": 5,
            "description": "弹性公网IP EIP带宽大小，单位：Mbit/s，计费方式为按带宽计费。取值范围：1-2,000。默认5。",
            "type": "number",
            "nullable": false,
            "validation": {
                "condition": "${length(regexall(\"^([1-9]|[1-9]\\\\d{1,2}|1\\\\d{3}|2000)$\",var.eip_bandwidth_size))>0}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "obs_bucket_name": {
            "default": "",
            "description": "对象存储服务 OBS桶名称前缀，命名方式：{obs_bucket_name}-obs，用于存放应用数据，不允许重名。取值范围：1-59个字符，以字母或数字开头、结尾，仅支持小写字母、数字、中划线（-）、英文句号（.）。",
            "type": "string",
            "nullable": false,
            "validation": {
                "condition": "${length(regexall(\"^[a-z0-9][a-z0-9\\\\.-]{0,57}[a-z0-9]$\",var.obs_bucket_name))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "ecs_name": {
            "default": "gameflexmatch-hosting-platform-demo",
            "description": "弹性云服务器 ECS名称前缀，不允许重名。命名规则{ecs_name}-appgateway0X、{ecs_name}-aass0X、{ecs_name}-fleetmanager0X及{ecs_name}-console，其中X取值[1,2]。取值范围：1-49个字符，支持数字、字母、_（下划线）、-（中划线）、.（点）。默认为gameflexmatch-hosting-platform-demo",
            "type": "string",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^[\\\\w-\\\\.]{1,49}$\",var.ecs_name))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "ecs_flavor": {
            "default": "c7.large.2",
            "description": "ECS规格，请使用2vCPUs4GB及以上规格，请参考部署指南配置。默认c7.large.2（c7|2vCPUs|4GB）。",
            "type": "string",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^[a-z][a-z0-9]{0,3}\\\\.(x||[1-9][0-9]{0,1}x)large\\\\.[1-9][0-9]{0,1}$\",var.ecs_flavor))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "ecs_password": {
            "default": "",
            "description": "ECS初始化密码及Console运维平台初始化密码，创建完成后，请参考部署指南登录ECS控制台修改密码。取值范围：长度为8-26位，密码至少必须包含大写字母、小写字母、数字和特殊字符（!@$%?*#.）中的三种，密码不能包含用户名或用户名的逆序。管理员帐户为root。",
            "type": "string",
            "nullable": "false",
            "sensitive": "true"
        },
        "ecs_disk_size": {
            "default": 100,
            "description": "ECS系统盘大小，磁盘类型默认通用型SSD，以GB为单位，取值范围为40-1,024，不支持缩盘。默认为100。",
            "type": "number",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^([4-9]\\\\d|[1-9]\\\\d{2}|10[0-1][0-9]|102[0-4])$\",var.ecs_disk_size))>0}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "rds_name": {
            "default": "gameflexmatch-hosting-platform-demo",
            "description": "云数据库RDS for MySQL名称，不支持重名。取值范围：4-64个字符，以字母开头，支持数字、字母、_（下划线）、-（中划线）。默认：gameflexmatch-hosting-platform-demo。",
            "type": "string",
            "nullable": false,
            "validation": {
                "condition": "${length(regexall(\"^[a-zA-Z][\\\\w-]{3,63}$\",var.rds_name))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "rds_flavor": {
            "default": "rds.mysql.n1.large.2.ha",
            "description": "云数据库RDS规格，详细规格信息请参考https://support.huaweicloud.com/productdesc-rds/rds_01_0034.html。默认：rds.mysql.n1.large.2.ha（通用型主备实例2vCPU4GB）。",
            "type": "string",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^(rds.mysql.)(n1.|x1.)(x|2x|4x|8x|16x||)large.((2|4|8).ha|(2|4|8))$\",var.rds_flavor))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "rds_volume_size": {
            "default": 100,
            "description": "云数据库RDS实例存储空间大小，默认存储盘类型为SSD云盘，取值范围：40-4,000，必须为10的整数倍。默认100GB。",
            "type": "number",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^([4-9]0|[1-9][0-9]0|[1-3][0-9]{2}0|4000)$\",var.rds_volume_size))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "rds_password": {
            "default": "",
            "description": "云数据库RDS for MySQL  root用户登录密码，默认为3个服务组件分别创建三个数据库appgateway/aass/fleetmanager及同名数据库登录用户，初始密码为该密码。取值范围：8-32个字符，必须至少包含大写字母、小写字母、数字和特殊字符（~!@#$%^*-_=+?,()&）中的三种。",
            "type": "string",
            "nullable": false,
            "sensitive": true
        },
        "influx_name": {
            "default": "gameflexmatch-hosting-platform-demo",
            "description": "云数据库GaussDB(for InfluxDB)实例名称，取值范围：4-64个字符，以字母开头，支持数字、字母、_（下划线）、-（中划线）。默认为gameflexmatch-hosting-platform-demo。",
            "type": "string",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^[a-zA-Z][\\\\w-]{3,63}$\",var.influx_name))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "influx_flavor": {
            "default": "geminidb.influxdb.large.4",
            "description": "云数据库GaussDB(for InfluxDB)实例规格，规格信息请参考https://support.huaweicloud.com/influxug-nosql/nosql_05_0045.html。默认为geminidb.influxdb.large.4（2vCPUs|8GB）。",
            "type": "string",
            "nullable": "false",
            "validation": {
                "condition": "${contains([\"geminidb.influxdb.large.4\",\"geminidb.influxdb.xlarge.4\",\"geminidb.influxdb.2xlarge.4\",\"geminidb.influxdb.4xlarge.4\",\"geminidb.influxdb.8xlarge.4\"], var.influx_flavor)}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "influx_volume_size": {
            "default": 100,
            "description": "云数据库GaussDB(for InfluxDB)实例存储空间大小，以GB为单位，取值范围：100-12,000。默认100。",
            "type": "number",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^([1-9][0-9]{2,3}|1[0-1][0-9]{3}|12000)$\",var.influx_volume_size))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "influx_password": {
            "default": "",
            "description": "云数据库GaussDB(for InfluxDB)实例初始化密码，取值范围：长度为8-32个字符，必须是大写字母、小写字母、数字、特殊字符~!@#%^*-_=+?的组合。管理员账户名默认为rwuser。",
            "type": "string",
            "nullable": "false",
            "sensitive": "true"
        },
        "redis_name": {
            "default": "gameflexmatch-hosting-platform-demo",
            "description": "分布式缓存服务 Redis版实例名称，取值范围：4-64个字符，以字母开头，支持数字、字母、_（下划线）、-（中划线）。默认gameflexmatch-hosting-platform-demo。",
            "type": "string",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^[a-zA-Z][\\\\w-]{3,63}$\",var.redis_name))>0}",
                "error_message": "Invalid input. Please re-enter."
            }
        },
        "redis_capacity": {
            "default": 2,
            "description": "分布式缓存服务 Redis版主备实例缓存内存规格，以GB为单位，具体规格详见：https://support.huaweicloud.com/productdesc-dcs/dcs-pd-0522002.html。默认2。",
            "type": "number",
            "nullable": "false",
            "validation": {
                "condition": "${contains([0.125,0.25,0.5,1,2,4,8,16,24,32,48,64], var.redis_capacity)}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "redis_password": {
            "default": "",
            "description": "分布式缓存服务 Redis版实例初始化密码，取值范围：长度为8-32个字符，必须至少包含大写字母、小写字母、数字、特殊字符~!@#%^*-_=+?中的三种。",
            "type": "string",
            "nullable": "false",
            "sensitive": "true"
        },
        "elb_name": {
            "default": "gameflexmatch-hosting-platform-demo",
            "description": "弹性负载均衡 ELB名称前缀，命名规则{elb_name}_appgateway、{elb_name}_aass、{elb_name}_fleetmanager。取值范围：1-51个字符组成，支持中文、英文字母、数字、_（下划线）、-（中划线）、.（点）。默认gameflexmatch-hosting-platform-demo。",
            "type": "string",
            "nullable": "false"
        },
        "domain_id": {
            "default": "",
            "description": "账户ID，请参考部署指南获取。取值范围：32位，仅支持小写字母和数字。",
            "type": "string",
            "nullable": false,
            "sensitive": true,
            "validation": {
                "condition": "${length(regexall(\"^[a-z0-9]{32}$\",var.domain_id))>0}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "access_key": {
            "default": "",
            "description": "账号访问密钥（AK），识别访问用户的身份。用于资源创建及上传镜像环境配置文件至OBS桶及GameFlexMatch的管理面服务组件的管理与执行，请参考部署指南获取。取值范围：20个字符，仅支持大写字母和数字。",
            "type": "string",
            "nullable": "false",
            "sensitive": "true",
            "validation": {
                "condition": "${length(regexall(\"^[A-Z0-9]{20}$\",var.access_key))>0}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "secret_access_key": {
            "default": "",
            "description": "账号秘密访问密钥（SK），对请求数据进行签名验证。用于资源创建上传镜像环境配置文件至OBS桶及GameFlexMatch的管理面服务组件的管理与执行，请参考部署指南获取。取值范围：40个字符，仅支持大小写字母和数字。",
            "type": "string",
            "nullable": "false",
            "sensitive": "true",
            "validation": {
                "condition": "${length(regexall(\"^[A-Za-z0-9]{40}$\",var.secret_access_key))>0}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "iam_agency_name": {
            "default": "",
            "description": "IAM委托名，不能重名，用于打包镜像时安装ICAgent以及使用LTS云日志服务的日志转储。取值范围：长度1-59个字符，支持字母、数字、空格及特殊字符-_.,。",
            "type": "string",
            "nullable": "false",
            "validation": {
                "condition": "${length(regexall(\"^[\\\\w\\\\s-\\\\.,]{1,59}$\",var.iam_agency_name))>0}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "charge_mode": {
            "default": "postPaid",
            "description": "计费模式，默认自动扣费，可选值为：postPaid（按需计费）、prePaid（包年包月）。默认postPaid。",
            "type": "string",
            "nullable": false,
            "validation": {
                "condition": "${contains([\"postPaid\",\"prePaid\"], var.charge_mode)}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "charge_period_unit": {
            "default": "month",
            "description": "订购周期类型，仅当charge_mode为prePaid（包年/包月）生效。取值范围：month（月），year（年）。默认month。",
            "type": "string",
            "nullable": false,
            "validation": {
                "condition": "${contains([\"month\",\"year\"], var.charge_period_unit)}",
                "error_message": "Invalid input, please re-enter."
            }
        },
        "charge_period": {
            "default": 1,
            "description": "订购周期，仅当charge_mode为prePaid（包年/包月）生效。取值范围：charge_period_unit=month（周期类型为月）时，取值为1-9；charge_period_unit=year（周期类型为年）时，取值为1-3。默认订购1月。",
            "type": "number",
            "nullable": false,
            "validation": {
                "condition": "${length(regexall(\"^[1-9]$\",var.charge_period))>0}",
                "error_message": "Invalid input, please re-enter."
            }
        }
    },
    "data": {
        "huaweicloud_availability_zones": {
            "az": {}
        },
        "huaweicloud_images_image": {
            "centos": {
                "name": "CentOS 7.9 64bit",
                "visibility": "public",
                "most_recent": true
            }
        },
        "huaweicloud_dcs_flavors": {
            "dcs_flavors": {
                "engine_version": "5.0",
                "cache_mode": "ha",
                "capacity": "${var.redis_capacity}"
            }
        },
        "huaweicloud_rds_instances": {
            "rds_instance": {
                "depends_on": [
                    "huaweicloud_rds_instance.rds_single_instance",
                    "huaweicloud_rds_instance.rds_ha_instance"
                ],
                "name": "${var.rds_name}",
                "datastore_type": "MySQL",
                "vpc_id": "${huaweicloud_vpc_subnet.subnet.vpc_id}",
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.id}"
            }
        }
    },
    "locals": {
        "az": [
            "${data.huaweicloud_availability_zones.az.names[0]}",
            "${data.huaweicloud_availability_zones.az.names[1]}"
        ]
    },
    "resource": {
        "huaweicloud_vpc": {
            "vpc": {
                "name": "${var.vpc_name}",
                "cidr": "192.168.0.0/16"
            }
        },
        "huaweicloud_vpc_subnet": {
            "subnet": {
                "availability_zone": "${data.huaweicloud_availability_zones.az.names[0]}",
                "name": "${var.vpc_name}-subnet",
                "cidr": "192.168.1.0/24",
                "gateway_ip": "192.168.1.1",
                "vpc_id": "${huaweicloud_vpc.vpc.id}"
            }
        },
        "huaweicloud_vpc_address_group": {
            "ipgroup": {
                "description": "允许Appgateway和Auxproxy网络互访",
                "name": "GameFlexMatch_ipGroup",
                "addresses": [
                    "${huaweicloud_vpc_eip.eip[0].address}",
                    "${huaweicloud_vpc_eip.eip[1].address}",
                    "${huaweicloud_vpc_eip.eip[7].address}"
                ]
            }
        },
        "huaweicloud_networking_secgroup": {
            "secgroup": {
                "name": "${var.security_group_name}"
            }
        },
        "huaweicloud_networking_secgroup_rule": {
            "allow_ping": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许ping程序测试弹性云服务器的连通性",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "icmp",
                "remote_ip_prefix": "0.0.0.0/0"
            },
            "allow_ssh_linux": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许SSH远程连接Linux弹性云服务器",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 22,
                "remote_ip_prefix": "${huaweicloud_vpc_subnet.subnet.cidr}"
            },
            "allow_accessing_mysql": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许访问MySQL",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 3306,
                "remote_ip_prefix": "${huaweicloud_vpc_subnet.subnet.cidr}"
            },
            "allow_accessing_appgateway": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许访问Appgateway服务组件",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 60003,
                "remote_ip_prefix": "${huaweicloud_vpc_subnet.subnet.cidr}"
            },
            "allow_component_mutual_access": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许访问Appgateway服务组件和Auxproxy服务组件互访",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 60003,
                "remote_address_group_id": "${huaweicloud_vpc_address_group.ipgroup.id}"
            },
            "allow_accessing_aass": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许访问AASS服务组件",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 9091,
                "remote_ip_prefix": "${huaweicloud_vpc_subnet.subnet.cidr}"
            },
            "allow_accessing_fleetmanager": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许访问Fleetmanager服务组件",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 31002,
                "remote_ip_prefix": "${huaweicloud_vpc_subnet.subnet.cidr}"
            },
            "allow_accessing_redis": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许访问Redis",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 6379,
                "remote_ip_prefix": "${huaweicloud_vpc_subnet.subnet.cidr}"
            },
            "allow_accessing_console": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许访问GameFlexMatch运维平台",
                "direction": "ingress",
                "ethertype": "IPv4",
                "protocol": "tcp",
                "ports": 80,
                "remote_ip_prefix": "0.0.0.0/0"
            },
            "allow_elb_accessing_ecs": {
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "description": "允许通过ELB访问后端服务器",
                "direction": "ingress",
                "ethertype": "IPv4",
                "remote_ip_prefix": "100.125.0.0/16"
            }
        },
        "huaweicloud_vpc_eip": {
            "eip": {
                "count": 9,
                "name": "${var.vpc_name}-eip",
                "bandwidth": {
                    "name": "${var.vpc_name}-bandwidth",
                    "share_type": "PER",
                    "size": "${var.eip_bandwidth_size}",
                    "charge_mode": "bandwidth"
                },
                "publicip": {
                    "type": "5_bgp"
                },
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}"
            }
        },
        "huaweicloud_compute_servergroup": {
            "servergroup": {
                "name": "${var.ecs_name}-servergroup",
                "policies": [
                    "anti-affinity"
                ]
            }
        },
        "huaweicloud_obs_bucket": {
            "bucket": {
                "acl": "private",
                "bucket": "${var.obs_bucket_name}-obs",
                "multi_az": false
            }
        },
        "huaweicloud_compute_instance": {
            "appgateway1": {
                "name": "${var.ecs_name}-appgateway01",
                "availability_zone": "${data.huaweicloud_availability_zones.az.names[0]}",
                "image_id": "${data.huaweicloud_images_image.centos.id}",
                "flavor_id": "${var.ecs_flavor}",
                "security_group_ids": [
                    "${huaweicloud_networking_secgroup.secgroup.id}"
                ],
                "system_disk_type": "GPSSD",
                "system_disk_size": "${var.ecs_disk_size}",
                "admin_pass": "${var.ecs_password}",
                "delete_disks_on_termination": true,
                "network": {
                    "uuid": "${huaweicloud_vpc_subnet.subnet.id}"
                },
                "scheduler_hints": {
                    "group": "${huaweicloud_compute_servergroup.servergroup.id}"
                },
                "agent_list": "hss,ces",
                "eip_id": "${huaweicloud_vpc_eip.eip[0].id}",
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}",
                "user_data": "#!/bin/bash\necho 'root:${var.ecs_password}' | chpasswd\nwget -P /tmp/ https://documentation-samples.obs.cn-north-4.myhuaweicloud.com/solution-as-code-publicbucket/solution-as-code-moudle/game-hosting-platform-based-on-gameflexmatch/userdata/init-backend.sh\nchmod +x /tmp/init-backend.sh\nsh /tmp/init-backend.sh ${huaweicloud_compute_instance.appgateway2.access_ip_v4} ${huaweicloud_compute_instance.aass[0].access_ip_v4} ${huaweicloud_compute_instance.aass[1].access_ip_v4} ${huaweicloud_compute_instance.fleetmanager[0].access_ip_v4} ${huaweicloud_compute_instance.fleetmanager[1].access_ip_v4} ${var.ecs_password} ${huaweicloud_lb_loadbalancer.elb_aass.vip_address} ${data.huaweicloud_rds_instances.rds_instance.instances[0].fixed_ip} ${var.rds_password} ${huaweicloud_gaussdb_influx_instance.gaussdb_influx_instance.lb_ip_address} ${var.influx_password} ${huaweicloud_dcs_instance.redis_instance.private_ip} ${var.redis_password} ${huaweicloud_lb_loadbalancer.elb_appgateway.vip_address} ${var.enterprise_project_id} ${var.domain_id} ${var.access_key} ${var.secret_access_key} ${huaweicloud_obs_bucket.bucket.bucket} ${huaweicloud_vpc_eip.eip[0].address} ${huaweicloud_vpc_eip.eip[1].address} ${huaweicloud_vpc_eip.eip[2].address} ${huaweicloud_vpc_eip.eip[3].address}> /tmp/init_backend.log 2>&1\nrm -rf /tmp/init-backend.sh"
            },
            "appgateway2": {
                "name": "${var.ecs_name}-appgateway02",
                "availability_zone": "${data.huaweicloud_availability_zones.az.names[1]}",
                "image_id": "${data.huaweicloud_images_image.centos.id}",
                "flavor_id": "${var.ecs_flavor}",
                "security_group_ids": [
                    "${huaweicloud_networking_secgroup.secgroup.id}"
                ],
                "system_disk_type": "GPSSD",
                "system_disk_size": "${var.ecs_disk_size}",
                "admin_pass": "${var.ecs_password}",
                "delete_disks_on_termination": true,
                "network": {
                    "uuid": "${huaweicloud_vpc_subnet.subnet.id}"
                },
                "eip_id": "${huaweicloud_vpc_eip.eip[1].id}",
                "scheduler_hints": {
                    "group": "${huaweicloud_compute_servergroup.servergroup.id}"
                },
                "agent_list": "hss,ces",
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}"
            },
            "aass": {
                "count": 2,
                "name": "${var.ecs_name}-aass0${count.index+1}",
                "availability_zone": "${local.az[count.index % 2]}",
                "image_id": "${data.huaweicloud_images_image.centos.id}",
                "flavor_id": "${var.ecs_flavor}",
                "security_group_ids": [
                    "${huaweicloud_networking_secgroup.secgroup.id}"
                ],
                "system_disk_type": "GPSSD",
                "system_disk_size": "${var.ecs_disk_size}",
                "admin_pass": "${var.ecs_password}",
                "delete_disks_on_termination": true,
                "network": {
                    "uuid": "${huaweicloud_vpc_subnet.subnet.id}"
                },
                "scheduler_hints": {
                    "group": "${huaweicloud_compute_servergroup.servergroup.id}"
                },
                "eip_id": "${huaweicloud_vpc_eip.eip[count.index+2].id}",
                "agent_list": "hss,ces",
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}"
            },
            "fleetmanager": {
                "count": 2,
                "name": "${var.ecs_name}-fleetmanager0${count.index+1}",
                "availability_zone": "${local.az[count.index % 2]}",
                "image_id": "${data.huaweicloud_images_image.centos.id}",
                "flavor_id": "${var.ecs_flavor}",
                "security_group_ids": [
                    "${huaweicloud_networking_secgroup.secgroup.id}"
                ],
                "system_disk_type": "GPSSD",
                "system_disk_size": "${var.ecs_disk_size}",
                "admin_pass": "${var.ecs_password}",
                "delete_disks_on_termination": true,
                "network": {
                    "uuid": "${huaweicloud_vpc_subnet.subnet.id}"
                },
                "scheduler_hints": {
                    "group": "${huaweicloud_compute_servergroup.servergroup.id}"
                },
                "eip_id": "${huaweicloud_vpc_eip.eip[count.index+4].id}",
                "agent_list": "hss,ces",
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}"
            },
            "console": {
                "depends_on": [
                    "huaweicloud_compute_instance.appgateway1"
                ],
                "name": "${var.ecs_name}-console",
                "availability_zone": "${data.huaweicloud_availability_zones.az.names[0]}",
                "image_id": "${data.huaweicloud_images_image.centos.id}",
                "flavor_id": "${var.ecs_flavor}",
                "security_group_ids": [
                    "${huaweicloud_networking_secgroup.secgroup.id}"
                ],
                "system_disk_type": "GPSSD",
                "system_disk_size": "${var.ecs_disk_size}",
                "admin_pass": "${var.ecs_password}",
                "delete_disks_on_termination": true,
                "network": {
                    "uuid": "${huaweicloud_vpc_subnet.subnet.id}"
                },
                "agent_list": "hss,ces",
                "eip_id": "${huaweicloud_vpc_eip.eip[6].id}",
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}",
                "user_data": "#!/bin/bash\necho 'root:${var.ecs_password}' | chpasswd\nwget -P /tmp/ https://documentation-samples.obs.cn-north-4.myhuaweicloud.com/solution-as-code-publicbucket/solution-as-code-moudle/game-hosting-platform-based-on-gameflexmatch/userdata/init-console.sh\nchmod +x /tmp/init-console.sh\nsh /tmp/init-console.sh ${huaweicloud_compute_instance.appgateway1.access_ip_v4} ${var.ecs_password} ${huaweicloud_lb_loadbalancer.elb_fleetmanager.vip_address} > /tmp/init-console.log 2>&1\nrm -rf /tmp/init-console.sh"
            }
        },
        "huaweicloud_rds_instance": {
            "rds_ha_instance": {
                "count": "${length(regexall(\"^*.ha$\",var.rds_flavor)) > 0 ? 1 : 0 }",
                "name": "${var.rds_name}",
                "availability_zone": [
                    "${data.huaweicloud_availability_zones.az.names[0]}",
                    "${data.huaweicloud_availability_zones.az.names[1]}"
                ],
                "flavor": "${var.rds_flavor}",
                "vpc_id": "${huaweicloud_vpc_subnet.subnet.vpc_id}",
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.id}",
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "backup_strategy": {
                    "keep_days": 7,
                    "start_time": "02:00-03:00"
                },
                "ha_replication_mode": "async",
                "db": {
                    "password": "${var.rds_password}",
                    "type": "MySQL",
                    "version": "5.7"
                },
                "volume": {
                    "size": "${var.rds_volume_size}",
                    "type": "CLOUDSSD"
                }
            },
            "rds_single_instance": {
                "count": "${length(regexall(\"^*.ha$\",var.rds_flavor)) > 0 ? 0 : 1 }",
                "name": "${var.rds_name}",
                "availability_zone": [
                    "${data.huaweicloud_availability_zones.az.names[0]}"
                ],
                "flavor": "${var.rds_flavor}",
                "vpc_id": "${huaweicloud_vpc_subnet.subnet.vpc_id}",
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.id}",
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "backup_strategy": {
                    "keep_days": 7,
                    "start_time": "02:00-03:00"
                },
                "db": {
                    "password": "${var.rds_password}",
                    "type": "MySQL",
                    "version": "5.7"
                },
                "volume": {
                    "size": "${var.rds_volume_size}",
                    "type": "CLOUDSSD"
                }
            }
        },
        "huaweicloud_rds_database": {
            "appgateway_database": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "name": "appgateway",
                "character_set": "utf8mb4"
            },
            "aass_database": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "name": "aass",
                "character_set": "utf8mb4"
            },
            "fleetmanager_database": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "name": "fleetmanager",
                "character_set": "utf8mb4"
            }
        },
        "huaweicloud_rds_mysql_account": {
            "user_appgateway": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "name": "appgateway",
                "password": "${var.rds_password}"
            },
            "user_aass": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "name": "aass",
                "password": "${var.rds_password}"
            },
            "user_fleetmanager": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "name": "fleetmanager",
                "password": "${var.rds_password}"
            }
        },
        "huaweicloud_rds_mysql_database_privilege": {
            "fleetmanager_database_privilege": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "db_name": "${huaweicloud_rds_database.fleetmanager_database.name}",
                "users": {
                    "name": "${huaweicloud_rds_mysql_account.user_fleetmanager.name}",
                    "readonly": false
                }
            },
            "aass_database_privilege": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "db_name": "${huaweicloud_rds_database.aass_database.name}",
                "users": {
                    "name": "${huaweicloud_rds_mysql_account.user_aass.name}",
                    "readonly": false
                }
            },
            "appgateway_database_privilege": {
                "instance_id": "${data.huaweicloud_rds_instances.rds_instance.instances[0].id}",
                "db_name": "${huaweicloud_rds_database.appgateway_database.name}",
                "users": {
                    "name": "${huaweicloud_rds_mysql_account.user_appgateway.name}",
                    "readonly": false
                }
            }
        },
        "huaweicloud_gaussdb_influx_instance": {
            "gaussdb_influx_instance": {
                "name": "${var.influx_name}",
                "password": "${var.influx_password}",
                "flavor": "${var.influx_flavor}",
                "volume_size": "${var.influx_volume_size}",
                "vpc_id": "${huaweicloud_vpc.vpc.id}",
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.id}",
                "security_group_id": "${huaweicloud_networking_secgroup.secgroup.id}",
                "availability_zone": "cn-north-4a,cn-north-4b,cn-north-4c",
                "backup_strategy": {
                    "start_time": "03:00-04:00",
                    "keep_days": 14
                },
                "ssl": true,
                "datastore": {
                    "engine": "influxdb",
                    "version": 1.7,
                    "storage_engine": "rocksDB"
                },
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}"
            }
        },
        "huaweicloud_dcs_instance": {
            "redis_instance": {
                "name": "${var.redis_name}",
                "engine": "Redis",
                "engine_version": "5.0",
                "capacity": "${var.redis_capacity}",
                "flavor": "${data.huaweicloud_dcs_flavors.dcs_flavors.flavors[0].name}",
                "availability_zones": [
                    "${data.huaweicloud_availability_zones.az.names[0]}",
                    "${data.huaweicloud_availability_zones.az.names[1]}"
                ],
                "password": "${var.redis_password}",
                "vpc_id": "${huaweicloud_vpc.vpc.id}",
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.id}",
                "whitelist_enable": false,
                "backup_policy": {
                    "backup_type": "auto",
                    "save_days": 3,
                    "backup_at": [
                        1,
                        3,
                        5,
                        7
                    ],
                    "begin_at": "02:00-04:00"
                },
                "charging_mode": "${var.charge_mode}",
                "period_unit": "${var.charge_period_unit}",
                "period": "${var.charge_period}"
            }
        },
        "huaweicloud_lb_loadbalancer": {
            "elb_appgateway": {
                "name": "${var.elb_name}_appgateway",
                "vip_subnet_id": "${huaweicloud_vpc_subnet.subnet.subnet_id}"
            },
            "elb_aass": {
                "name": "${var.elb_name}_aass",
                "vip_subnet_id": "${huaweicloud_vpc_subnet.subnet.subnet_id}"
            },
            "elb_fleetmanager": {
                "name": "${var.elb_name}_fleetmanager",
                "vip_subnet_id": "${huaweicloud_vpc_subnet.subnet.subnet_id}"
            }
        },
        "huaweicloud_lb_listener": {
            "elb_listener_appgateway": {
                "loadbalancer_id": "${huaweicloud_lb_loadbalancer.elb_appgateway.id}",
                "protocol": "TCP",
                "protocol_port": "60003"
            },
            "elb_listener_aass": {
                "loadbalancer_id": "${huaweicloud_lb_loadbalancer.elb_aass.id}",
                "protocol": "TCP",
                "protocol_port": "9091"
            },
            "elb_listener_fleetmanager": {
                "loadbalancer_id": "${huaweicloud_lb_loadbalancer.elb_fleetmanager.id}",
                "protocol": "TCP",
                "protocol_port": "31002"
            }
        },
        "huaweicloud_lb_pool": {
            "elb_pool_appgateway": {
                "lb_method": "ROUND_ROBIN",
                "listener_id": "${huaweicloud_lb_listener.elb_listener_appgateway.id}",
                "name": "elb_pool_appgateway",
                "protocol": "TCP"
            },
            "elb_pool_aass": {
                "lb_method": "ROUND_ROBIN",
                "listener_id": "${huaweicloud_lb_listener.elb_listener_aass.id}",
                "name": "elb_pool_aass",
                "protocol": "TCP"
            },
            "elb_pool_fleetmanager": {
                "lb_method": "ROUND_ROBIN",
                "listener_id": "${huaweicloud_lb_listener.elb_listener_fleetmanager.id}",
                "name": "elb_pool_fleetmanager",
                "protocol": "TCP"
            }
        },
        "huaweicloud_lb_member": {
            "elb_member_appgateway01": {
                "address": "${huaweicloud_compute_instance.appgateway1.access_ip_v4}",
                "pool_id": "${huaweicloud_lb_pool.elb_pool_appgateway.id}",
                "protocol_port": 60003,
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.subnet_id}",
                "weight": 1
            },
            "elb_member_appgateway02": {
                "address": "${huaweicloud_compute_instance.appgateway2.access_ip_v4}",
                "pool_id": "${huaweicloud_lb_pool.elb_pool_appgateway.id}",
                "protocol_port": 60003,
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.subnet_id}",
                "weight": 1
            },
            "elb_member_aass": {
                "address": "${huaweicloud_compute_instance.aass[count.index].access_ip_v4}",
                "count": 2,
                "pool_id": "${huaweicloud_lb_pool.elb_pool_aass.id}",
                "protocol_port": 9091,
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.subnet_id}",
                "weight": 1
            },
            "elb_member_fleetmanager": {
                "address": "${huaweicloud_compute_instance.fleetmanager[count.index].access_ip_v4}",
                "count": 2,
                "pool_id": "${huaweicloud_lb_pool.elb_pool_fleetmanager.id}",
                "protocol_port": 31002,
                "subnet_id": "${huaweicloud_vpc_subnet.subnet.subnet_id}",
                "weight": 1
            }
        },
        "huaweicloud_lb_monitor": {
            "elb_monitor_appgateway": {
                "delay": 5,
                "max_retries": 3,
                "pool_id": "${huaweicloud_lb_pool.elb_pool_appgateway.id}",
                "timeout": 3,
                "type": "TCP"
            },
            "elb_monitor_aass": {
                "delay": 5,
                "max_retries": 3,
                "pool_id": "${huaweicloud_lb_pool.elb_pool_aass.id}",
                "timeout": 3,
                "type": "TCP"
            },
            "elb_monitor_fleetmanager": {
                "delay": 5,
                "max_retries": 3,
                "pool_id": "${huaweicloud_lb_pool.elb_pool_fleetmanager.id}",
                "timeout": 3,
                "type": "TCP"
            }
        },
        "huaweicloud_vpc_eip_associate": {
            "eip_associate_appgateway": {
                "port_id": "${huaweicloud_lb_loadbalancer.elb_appgateway.vip_port_id}",
                "public_ip": "${huaweicloud_vpc_eip.eip[7].address}"
            },
            "eip_associate_fleetmanager": {
                "port_id": "${huaweicloud_lb_loadbalancer.elb_fleetmanager.vip_port_id}",
                "public_ip": "${huaweicloud_vpc_eip.eip[8].address}"
            }
        },
        "huaweicloud_identity_role": {
            "smn_role": {
                "name": "${var.iam_agency_name}_role",
                "description": "Allow SMN to send message notifications",
                "type": "XA",
                "policy": "{\n    \"Version\": \"1.1\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"smn:topic:update\",\n                \"smn:topic:create\",\n                \"smn:topic:delete\",\n                \"smn:topic:list\",\n                \"smn:topic:publish\"\n            ]\n        }\n    ]\n}"
            }
        },
        "huaweicloud_identity_agency": {
            "identity_agency": {
                "delegated_service_name": "op_svc_ecs",
                "name": "${var.iam_agency_name}",
                "project_role": [
                    {
                        "project": "cn-north-4",
                        "roles": [
                            "LTS Administrator",
                            "APM Administrator",
                            "Tenant Guest",
                            "Tenant Administrator",
                            "${huaweicloud_identity_role.smn_role.name}"
                        ]
                    }
                ]
            }
        }
    },
    "output": {
        "GameFlexMatch访问地址": {
            "value": "受网络波动影响，待资源创建成功后，等待约20分钟后，在浏览器中输入http://${huaweicloud_vpc_eip.eip[6].address}访问GameFlexMatch平台。管理员账号默认admin，初始化密码为弹性云服务器密码，首次登录系统后需要进行密码重置。"
        }
    }
}